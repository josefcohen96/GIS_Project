<!DOCTYPE html>
<html>

<head>
	<title>Party Locations</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
	<style>
		html,


		#map {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			z-index: 0;
		}

		#sidebar {
			position: absolute;
			bottom: 10px;
			left: 10px;
			background-color: white;
			padding: 10px;
			border-radius: 5px;
			background-color: rgba(255, 255, 255, 0.3);
		}

		.green-marker {
			display: inline-block;
			width: 12px;
			height: 12px;
			background-color: green;
			margin-right: 5px;
		}

		.orange-marker {
			display: inline-block;
			width: 12px;
			height: 12px;
			background-color: orange;
			margin-right: 5px;
		}

		.red-marker {
			display: inline-block;
			width: 12px;
			height: 12px;
			background-color: red;
			margin-right: 5px;
		}

		.marker-icon {
			width: 25px;
			height: 41px;
			margin-top: -20px;
			margin-left: -12px;
		}

		.red {
			background-color: red;
		}

		.blue {
			background-color: blue;
		}

		.container {
			position: absolute;
			bottom: 10px;
			right: 10px;
			z-index: 1000;
			background-color: rgba(255, 255, 255, 0.3);
			padding: 10px;
			border-radius: 4px;
		}

		.button-container {
			display: flex;
			justify-content: space-between;
			margin-bottom: 10px;
		}

		.button-container button {
			padding: 10px 20px;
			font-size: 16px;
			background-color: #4caf50;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
		}

		.search-bar {
			display: flex;
			align-items: center;
			margin-bottom: 10px;
		}

		.search-bar input[type="text"] {
			padding: 10px;
			font-size: 16px;
			border: 1px solid #ccc;
			border-radius: 4px;
		}

		.search-bar button {
			padding: 10px 20px;
			font-size: 16px;
			background-color: #2196f3;
			color: white;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			margin-left: 5px;
		}

		monthSelect {
			appearance: none;
			-webkit-appearance: none;
			padding: 10px;
			font-size: 16px;
			border: 1px solid #ccc;
			border-radius: 4px;
			width: 100%;
			background-color: #fff;
			background-image: url('path/to/down-arrow-icon.png');
			background-repeat: no-repeat;
			background-position: right center;
		}

		/* Style the dropdown arrow */
		#monthSelect::-ms-expand {
			display: none;
		}
	</style>
</head>

<body>


	<button onclick="search()">Search</button>
	<div id="map"></div>
	<div id="sidebar">
		<h3>Map Reading Instructions</h3>
		<ul>
			<li><span class="green-marker"></span> Less than a day</li>
			<li><span class="orange-marker"></span> Between one and two days</li>
			<li><span class="red-marker"></span> Over two days</li>
		</ul>
	</div>
	<div id="mapWindow">
		<div id="menu">
			<div class="container">
				<select id="monthSelect">
					<option value="">All Months</option>
					<option value="01">January</option>
					<option value="02">February</option>
					<option value="03">March</option>
					<option value="04">April</option>
					<option value="05">May</option>
					<option value="06">June</option>
					<option value="07">July</option>
					<option value="08">August</option>
					<option value="09">September</option>
					<option value="10">October</option>
					<option value="11">November</option>
					<option value="12">December</option>
				</select>
				<div class="search-bar">
					<input type="text" id="search-input" placeholder="Search">
					<button onclick="searchByMonth()">Search</button>
				</div>
				<div class="button-container">

					<button onclick="getCurrentLocation()">Get My Location</button>
					<button id="removeMarkerButton" onclick="removeTemporaryMarker()">Remove Marker</button>
				</div>
			</div>

		</div>
	</div>

	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
	<script>

		const parties =
			[
				{
					"name": "Tomorrowland",
					"coordinates": {
						"latitude": 51.0911,
						"longitude": 4.3663
					},
					"start_time": "2023-07-21 12:00",
					"end_time": "2023-07-24 23:59",
					"date": "2023-07-21",
					"marker": null
				},
				{
					"name": "Sziget Festival",
					"coordinates": {
						"latitude": 47.5181,
						"longitude": 19.0736
					},
					"start_time": "2023-08-09 14:00",
					"end_time": "2023-08-16 04:00",
					"date": "2023-08-09",
					"marker": null
				},
				{
					"name": "Ozora Festival",
					"coordinates": {
						"latitude": 46.6694,
						"longitude": 18.3315
					},
					"start_time": "2023-08-16 18:00",
					"end_time": "2023-08-22 12:00",
					"date": "2023-08-16",
					"marker": null
				},
				{
					"name": "Ultra Europe",
					"coordinates": {
						"latitude": 43.5115,
						"longitude": 16.4467
					},
					"start_time": "2023-07-14 16:00",
					"end_time": "2023-07-16 04:00",
					"date": "2023-07-14",
					"marker": null
				},
				{
					"name": "BaliSpirit Festival",
					"coordinates": {
						"latitude": -8.5211,
						"longitude": 115.2540
					},
					"start_time": "2023-03-19 09:00",
					"end_time": "2023-03-26 21:00",
					"date": "2023-03-19",
					"marker": null
				},
				{
					"name": "Wonderfruit Festival",
					"coordinates": {
						"latitude": 12.9649,
						"longitude": 100.9168
					},
					"start_time": "2023-12-14 14:00",
					"end_time": "2023-12-17 02:00",
					"date": "2023-12-14",
					"marker": null
				},
				{
					"name": "Sunburn Festival",
					"coordinates": {
						"latitude": 15.2993,
						"longitude": 74.1240
					},
					"start_time": "2023-12-27 18:00",
					"end_time": "2024-01-01 06:00",
					"date": "2023-12-27",
					"marker": null
				},
				{
					"name": "Rock in Rio",
					"coordinates": {
						"latitude": -22.9035,
						"longitude": -43.2096
					},
					"start_time": "2023-09-15 14:00",
					"end_time": "2023-09-24 23:59",
					"date": "2023-09-15",
					"marker": null
				},
				{
					"name": "Lollapalooza Argentina",
					"coordinates": {
						"latitude": -34.6108,
						"longitude": -58.3717
					},
					"start_time": "2023-03-17 12:00",
					"end_time": "2023-03-19 04:00",
					"date": "2023-03-17",
					"marker": null
				},
				{
					"name": "Ultra Brasil",
					"coordinates": {
						"latitude": -22.9056,
						"longitude": -43.1912
					},
					"start_time": "2023-10-12 16:00",
					"end_time": "2023-10-14 04:00",
					"date": "2023-10-12",
					"marker": null
				},
				{
					"name": "Villa CariÃ±o Festival",
					"coordinates": {
						"latitude": -33.4489,
						"longitude": -70.6693
					},
					"start_time": "2023-06-10 13:00",
					"end_time": "2023-06-11 01:00",
					"date": "2023-06-10",
					"marker": null
				},
				{
					"name": "Creamfields Chile",
					"coordinates": {
						"latitude": -33.4362,
						"longitude": -70.6341
					},
					"start_time": "2023-11-11 20:00",
					"end_time": "2023-11-12 05:00",
					"date": "2023-11-11",
					"marker": null
				},
				{
					"name": "Coachella",
					"coordinates": {
						"latitude": 33.6804,
						"longitude": -116.2378
					},
					"start_time": "2023-04-14 12:00",
					"end_time": "2023-04-23 23:59",
					"date": "2023-04-14",
					"marker": null
				},
				{
					"name": "EDC Las Vegas",
					"coordinates": {
						"latitude": 36.2712,
						"longitude": -115.0126
					},
					"start_time": "2023-05-19 18:00",
					"end_time": "2023-05-21 06:00",
					"date": "2023-05-19",
					"marker": null
				},
				{
					"name": "Bonnaroo Music Festival",
					"coordinates": {
						"latitude": 35.4819,
						"longitude": -86.0846
					},
					"start_time": "2023-06-08 14:00",
					"end_time": "2023-06-11 04:00",
					"date": "2023-06-08",
					"marker": null
				},
				{
					"name": "Electric Zoo",
					"coordinates": {
						"latitude": 40.7947,
						"longitude": -73.9224
					},
					"start_time": "2023-08-31 16:00",
					"end_time": "2023-09-03 04:00",
					"date": "2023-08-31",
					"marker": null
				},
				{
					"name": "Tel Aviv Music Festival",
					"coordinates": {
						"latitude": 32.0853,
						"longitude": 34.7818
					},
					"start_time": "2023-07-15 20:00",
					"end_time": "2023-07-16 03:00",
					"date": "2023-07-15",
					"marker": null
				},
				{
					"name": "Jerusalem Jazz Festival",
					"coordinates": {
						"latitude": 31.7683,
						"longitude": 35.2137
					},
					"start_time": "2023-09-22 18:00",
					"end_time": "2023-09-24 02:00",
					"date": "2023-09-22",
					"marker": null
				},
				{
					"name": "Haifa Electronic Music Festival",
					"coordinates": {
						"latitude": 32.7940,
						"longitude": 34.9896
					},
					"start_time": "2023-10-28 22:00",
					"end_time": "2023-10-29 06:00",
					"date": "2023-10-28",
					"marker": null
				},
				{
					"name": "Eilat Reggae Festival",
					"coordinates": {
						"latitude": 29.5580,
						"longitude": 34.9482
					},
					"start_time": "2023-11-17 16:00",
					"end_time": "2023-11-19 02:00",
					"date": "2023-11-17",
					"marker": null
				},
				{
					"name": "Cape Town Jazz Festival",
					"coordinates": {
						"latitude": -33.9249,
						"longitude": 18.4241
					},
					"start_time": "2023-08-10 19:30",
					"end_time": "2023-08-12 01:00",
					"date": "2023-08-10",
					"marker": null
				},
				{
					"name": "Marrakech Music Festival",
					"coordinates": {
						"latitude": 31.6295,
						"longitude": -7.9811
					},
					"start_time": "2023-09-15 20:00",
					"end_time": "2023-09-16 02:00",
					"date": "2023-09-15",
					"marker": null
				},
				{
					"name": "Cairo Electro Carnival",
					"coordinates": {
						"latitude": 30.0444,
						"longitude": 31.2357
					},
					"start_time": "2023-10-20 22:00",
					"end_time": "2023-10-21 04:00",
					"date": "2023-10-20",
					"marker": null
				},
				{
					"name": "Lagos Afrobeats Festival",
					"coordinates": {
						"latitude": 6.5244,
						"longitude": 3.3792
					},
					"start_time": "2023-11-25 18:00",
					"end_time": "2023-11-26 02:00",
					"date": "2023-11-25",
					"marker": null
				},
				{
					"name": "Nairobi Reggae Splash",
					"coordinates": {
						"latitude": -1.2864,
						"longitude": 36.8172
					},
					"start_time": "2023-12-10 15:00",
					"end_time": "2023-12-11 01:00",
					"date": "2023-12-10",
					"marker": null
				},
				{
					"name": "Moscow International Music Festival",
					"coordinates": {
						"latitude": 55.7512,
						"longitude": 37.6184
					},
					"start_time": "2023-07-05 18:30",
					"end_time": "2023-07-08 01:00",
					"date": "2023-07-05",
					"marker": null
				},
				{
					"name": "St. Petersburg Rock Fest",
					"coordinates": {
						"latitude": 59.9343,
						"longitude": 30.3351
					},
					"start_time": "2023-09-20 19:00",
					"end_time": "2023-09-22 02:00",
					"date": "2023-09-20",
					"marker": null
				},
				{
					"name": "Kazan Electronic Music Festival",
					"coordinates": {
						"latitude": 55.8304,
						"longitude": 49.0661
					},
					"start_time": "2023-10-15 22:00",
					"end_time": "2023-10-16 06:00",
					"date": "2023-10-15",
					"marker": null
				},
				{
					"name": "Dead Sea Rave",
					"coordinates": {
						"latitude": 31.7180,
						"longitude": 35.3613
					},
					"start_time": "2023-12-31 22:00",
					"end_time": "2024-01-01 07:00",
					"date": "2023-12-31",
					"marker": null
				},
				{
					"name": "Austin City Limits",
					"coordinates": {
						"latitude": 30.2500,
						"longitude": -97.7500
					},
					"start_time": "2023-10-06 12:00",
					"end_time": "2023-10-15 23:59",
					"date": "2023-10-06",
					"marker": null
				},
				{
					"name": "EXIT Festival",
					"coordinates": {
						"latitude": 45.2539,
						"longitude": 19.8447
					},
					"start_time": "2023-07-06 19:00",
					"end_time": "2023-07-09 05:00",
					"date": "2023-07-06",
					"marker": null
				},

				{
					"start_time": "2023-12-09T20:00:00Z",
					"end_time": "2023-12-10T02:00:00Z",
					"date": "2023-12-09",
					"marker": null
				},
				{
					"name": "Tomorrowland",
					"coordinates": {
						"latitude": 51.0911,
						"longitude": 4.3663
					},
					"start_time": "2023-07-21 12:00",
					"end_time": "2023-07-24 23:59",
					"date": "2023-07-21",
					"marker": null
				},
				{
					"name": "Sziget Festival",
					"coordinates": {
						"latitude": 47.5181,
						"longitude": 19.0736
					},
					"start_time": "2023-08-09 14:00",
					"end_time": "2023-08-16 04:00",
					"date": "2023-08-09",
					"marker": null
				},
				{
					"name": "Ozora Festival",
					"coordinates": {
						"latitude": 46.6694,
						"longitude": 18.3315
					},
					"start_time": "2023-08-16 18:00",
					"end_time": "2023-08-22 12:00",
					"date": "2023-08-16",
					"marker": null
				},
				{
					"name": "Ultra Europe",
					"coordinates": {
						"latitude": 43.5115,
						"longitude": 16.4467
					},
					"start_time": "2023-07-14 16:00",
					"end_time": "2023-07-16 04:00",
					"date": "2023-07-14",
					"marker": null
				},
				{
					"name": "EXIT Festival",
					"coordinates": {
						"latitude": 45.2539,
						"longitude": 19.8447
					},
					"start_time": "2023-07-06 19:00",
					"end_time": "2023-07-09 05:00",
					"date": "2023-07-06",
					"marker": null
				},

				{
					"name": "Rainbow Serpent Festival",
					"coordinates": {
						"latitude": -37.2546,
						"longitude": 143.8299
					},
					"start_time": "2023-01-27 16:00",
					"end_time": "2023-01-30 12:00",
					"date": "2023-01-27",
					"marker": null
				},
				{
					"name": "Earth Frequency Festival",
					"coordinates": {
						"latitude": -27.4556,
						"longitude": 152.8114
					},
					"start_time": "2023-02-17 18:30",
					"end_time": "2023-02-20 03:00",
					"date": "2023-02-17",
					"marker": null
				},
				{
					"name": "Strawberry Fields Festival",
					"coordinates": {
						"latitude": -36.4174,
						"longitude": 145.5731
					},
					"start_time": "2023-11-17 17:00",
					"end_time": "2023-11-20 02:00",
					"date": "2023-11-17",
					"marker": null
				},
				{
					"name": "Splendour in the Grass",
					"coordinates": {
						"latitude": -28.3852,
						"longitude": 153.5509
					},
					"start_time": "2023-07-21 19:30",
					"end_time": "2023-07-24 03:30",
					"date": "2023-07-21",
					"marker": null
				},
				{
					"name": "Lost Paradise",
					"coordinates": {
						"latitude": -33.3129,
						"longitude": 150.5050
					},
					"start_time": "2023-12-29 20:00",
					"end_time": "2024-01-01 06:00",
					"date": "2023-12-29",
					"marker": null
				},

				{
					"name": "Eclipse Festival",
					"coordinates": {
						"latitude": 45.5017,
						"longitude": -73.5673
					},
					"start_time": "2023-07-29 18:00",
					"end_time": "2023-08-02 12:00",
					"date": "2023-07-29",
					"marker": null
				},
				{
					"name": "Shambhala Music Festival",
					"coordinates": {
						"latitude": 49.4994,
						"longitude": -117.6654
					},
					"start_time": "2023-08-09 20:00",
					"end_time": "2023-08-14 02:00",
					"date": "2023-08-09",
					"marker": null
				},
				{
					"name": "Bass Coast Festival",
					"coordinates": {
						"latitude": 50.1214,
						"longitude": -122.9543
					},
					"start_time": "2023-08-18 17:30",
					"end_time": "2023-08-21 03:30",
					"date": "2023-08-18",
					"marker": null
				},
				{
					"name": "Ever After Music Festival",
					"coordinates": {
						"latitude": 43.4120,
						"longitude": -80.4778
					},
					"start_time": "2023-09-01 16:00",
					"end_time": "2023-09-04 01:00",
					"date": "2023-09-01",
					"marker": null
				},
				{
					"name": "Bestival Toronto",
					"coordinates": {
						"latitude": 43.6532,
						"longitude": -79.3832
					},
					"start_time": "2023-09-09 19:30",
					"end_time": "2023-09-10 03:30",
					"date": "2023-09-09",
					"marker": null
				}
			]

		let temporaryMarker;

		function createMarkers() {
			parties.forEach(party => {
				const marker = L.marker([party.coordinates.latitude, party.coordinates.longitude], {
					icon: L.icon({
						iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
						iconSize: [25, 41],
						iconAnchor: [12, 41],
						popupAnchor: [1, -34],
						shadowSize: [41, 41]
					})
				});

				const duration = (new Date(party.end_time) - new Date(party.start_time)) / 3600000; // Duration in hours
				const color = getColor(duration);

				party.marker = marker; // Assign the marker to the party object
				marker.addTo(map)
					.bindPopup(`<b>${party.name}</b><br>${party.start_time} - ${party.end_time}`)
					.setIcon(L.icon({
						iconUrl: `https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
						iconSize: [25, 41],
						iconAnchor: [12, 41],
						popupAnchor: [1, -34],
						shadowSize: [41, 41]
					}));

				marker.addEventListener('click', function () {
					map.setView(marker.getLatLng(), 13); // Adjust the zoom level as needed
				});
			});
		}

		function removeTemporaryMarker() {
			// Check if the temporary marker exists
			if (temporaryMarker) {
				// Remove the marker from the map
				map.removeLayer(temporaryMarker);
				// Set the temporary marker variable to null
				temporaryMarker = null;
			}
		}

		function getColor(duration) {
			if (duration <= 24) {
				return 'green';
			} else if (duration <= 48) {
				return 'orange';
			} else {
				return 'red';
			}
		}

		function clearMarkers() {
			parties.forEach(party => {
				if (party.marker) {
					party.marker.removeFrom(map); // Remove the marker from the map
				}
			});
		}

		function searchByMonth() {
			var selectedMonth = document.getElementById("monthSelect").value;
			var filteredParties = [];

			if (selectedMonth === "") {
				filteredParties = parties;
			} else {
				filteredParties = parties.filter(function (party) {
					var partyMonth = party.date.slice(5, 7);
					return partyMonth === selectedMonth;
				});
			}
			clearMarkers();
			// Call a function to display the filtered parties on the map

			displayParties(filteredParties);
		}

		function getCurrentLocation() {
			if ("geolocation" in navigator) {
				navigator.geolocation.getCurrentPosition(
					function (position) {
						const latitude = position.coords.latitude;
						const longitude = position.coords.longitude;

						map.setView([latitude, longitude], 12);

						if (temporaryMarker) {
							map.removeLayer(temporaryMarker);
						}

						temporaryMarker = L.marker([latitude, longitude]).addTo(map);
					},
					function (error) {
						console.log("Error getting geolocation:", error);
					}
				);
			} else {
				console.log("Geolocation is not supported");
			}
		}

		function displayParties(parties) {
			clearMarkers();

			// Remove existing markers from the map
			parties.forEach(function (party) {
				if (party.marker) {
					map.removeLayer(party.marker);
				}
			});

			// Add markers for the filtered parties on the map
			parties.forEach(party => {
				const marker = L.marker([party.coordinates.latitude, party.coordinates.longitude], {
					icon: L.icon({
						iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
						iconSize: [25, 41],
						iconAnchor: [12, 41],
						popupAnchor: [1, -34],
						shadowSize: [41, 41]
					})
				});

				const duration = (new Date(party.end_time) - new Date(party.start_time)) / 3600000; // Duration in hours
				const color = getColor(duration);

				party.marker = marker; // Assign the marker to the party object
				marker.addTo(map)
					.bindPopup(`<h3>${party.name}</h3><p>Date: ${party.date}</p><p>Start Time: ${party.start_time}</p><p>End Time: ${party.end_time}</p>`)
					.setIcon(L.icon({
						iconUrl: `https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
						iconSize: [25, 41],
						iconAnchor: [12, 41],
						popupAnchor: [1, -34],
						shadowSize: [41, 41]
					}));
			});
		}

		// Initialize the map
		const map = L.map('map').setView([36.5200, 8.4050], 3);
		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
			maxZoom: 9
		}).addTo(map);

		createMarkers();
	</script>
</body>

</html>